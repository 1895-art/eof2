
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Practical Example: Sea Surface Temperature (ENSO) &mdash; eof2 1.5.0 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/extension.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.5.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="eof2 1.5.0 documentation" href="index.html" />
    <link rel="next" title="Metadata-Enabled Interface Reference" href="refwrap.html" />
    <link rel="prev" title="Introduction" href="intro.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="refwrap.html" title="Metadata-Enabled Interface Reference"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="intro.html" title="Introduction"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">eof2 1.5.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="practical-example-sea-surface-temperature-enso">
<h1>Practical Example: Sea Surface Temperature (ENSO)<a class="headerlink" href="#practical-example-sea-surface-temperature-enso" title="Permalink to this headline">¶</a></h1>
<p>This example applies EOF analysis to wintertime Pacific sea surface temperature (SST) anomalies. The leading mode of variability in the Pacific in wintertime is El Niño, so our leading EOF should show the spatial signature of El Niño, and our leading PC time series should show variability on typical El Niño time-scales.</p>
<div class="section" id="getting-the-example-data">
<h2>Getting The Example Data<a class="headerlink" href="#getting-the-example-data" title="Permalink to this headline">¶</a></h2>
<p>The data for this example are SST anomalies obtained from the <a class="reference external" href="http://www.esrl.noaa.gov/psd/data/gridded/">Kaplan SST</a> data set. The following Python code can be used to download the data (~9 MB) in NetCDF format:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">urllib2</span>

<span class="n">sst_remote</span> <span class="o">=</span> <span class="s">&quot;http://www.esrl.noaa.gov/psd/thredds/fileServer/Datasets/kaplan_sst/sst.mon.anom.nc&quot;</span>
<span class="n">sst_local</span> <span class="o">=</span> <span class="s">&quot;sst.mon.mean.nc&quot;</span>
<span class="n">ncremote</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">sst_remote</span><span class="p">)</span>
<span class="n">nclocal</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sst_local</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span>
<span class="n">nclocal</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ncremote</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="n">nclocal</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">ncremote</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="reading-and-preparing-the-example-data">
<h2>Reading And Preparing The Example Data<a class="headerlink" href="#reading-and-preparing-the-example-data" title="Permalink to this headline">¶</a></h2>
<p>In this example we&#8217;ll analyse November-March (NDJFM) means of SST anomaly. We first read in SST, then extract NDJFM seasonal means. This is done using the <tt class="xref py py-mod docutils literal"><span class="pre">cdms2</span></tt> and <tt class="xref py py-mod docutils literal"><span class="pre">cdutil</span></tt> packages from CDAT:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">cdms2</span>
<span class="kn">import</span> <span class="nn">cdutil</span>

<span class="c"># Read the SST data from the file we downloaded previously.</span>
<span class="n">ncin</span> <span class="o">=</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">sst_local</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>
<span class="n">sst</span> <span class="o">=</span> <span class="n">ncin</span><span class="p">(</span><span class="s">&quot;sst&quot;</span><span class="p">)</span>
<span class="n">ncin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># Tell cdutil that this is a monthly data set, and construct NDJFM</span>
<span class="c"># means.</span>
<span class="n">cdutil</span><span class="o">.</span><span class="n">setTimeBoundsMonthly</span><span class="p">(</span><span class="n">sst</span><span class="p">)</span>
<span class="n">NDJFM</span> <span class="o">=</span> <span class="n">cdutil</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">Seasons</span><span class="p">(</span><span class="s">&quot;NDJFM&quot;</span><span class="p">)</span>
<span class="n">sst_djf</span> <span class="o">=</span> <span class="n">NDJFM</span><span class="p">(</span><span class="n">sst</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="the-eof-analysis">
<h2>The EOF Analysis<a class="headerlink" href="#the-eof-analysis" title="Permalink to this headline">¶</a></h2>
<p>In this example we&#8217;ll compute the leading EOF of SST in the tropical and North Pacific. This region is defined here as 120E-60W, 20S-60N. We also retrieve the corrsponding PC time series scaled to unit variance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">eof2</span> <span class="kn">import</span> <span class="n">Eof</span>

<span class="c"># Select the Central and North Pacific region.</span>
<span class="n">sst_djf_cp</span> <span class="o">=</span> <span class="n">sst_djf</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="s">&quot;ccb&quot;</span><span class="p">),</span> <span class="n">longitude</span><span class="o">=</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="s">&quot;ccb&quot;</span><span class="p">))</span>

<span class="c"># Create and Eof solver. Square-root of cosine of latitude weights are</span>
<span class="c"># applied to the data to account for the convergence of meridians.</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">Eof</span><span class="p">(</span><span class="n">sst_djf_cp</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s">&quot;coslat&quot;</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># Retrieve the leading EOF expressed as the correlation between the</span>
<span class="c"># leading PC and the SST anaomaly data at every grid point.</span>
<span class="n">eof1</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">eofsAsCorrelation</span><span class="p">(</span><span class="n">neofs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># Retrieve the corresponding PC time series. Use scaling option &#39;1&#39; to</span>
<span class="c"># give the returned PCs unit variance.</span>
<span class="n">pc1</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">pcs</span><span class="p">(</span><span class="n">npcs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pcscaling</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="visualizing-the-results">
<h2>Visualizing The Results<a class="headerlink" href="#visualizing-the-results" title="Permalink to this headline">¶</a></h2>
<p>Now we&#8217;ll use the <tt class="xref py py-mod docutils literal"><span class="pre">matplotlib</span></tt> package along with the <tt class="xref py py-mod docutils literal"><span class="pre">mpl_toolkits.basemap</span></tt> toolkit to plot the spatial pattern of leading EOF and a subset of the leading PC time series:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.basemap</span> <span class="kn">import</span> <span class="n">Basemap</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c"># Create a Basemap object to handle map projections. Use this to transform</span>
<span class="c"># geophysical coordinates to map projection coordinates.</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s">&quot;cyl&quot;</span><span class="p">,</span> <span class="n">llcrnrlon</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">llcrnrlat</span><span class="o">=-</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">urcrnrlon</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">urcrnrlat</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="n">eof1</span><span class="o">.</span><span class="n">getLongitude</span><span class="p">()[:],</span> <span class="n">eof1</span><span class="o">.</span><span class="n">getLatitude</span><span class="p">()[:]</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">))</span>

<span class="c"># Plot a filled contour map of the leading EOF.</span>
<span class="n">clevs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">eof1</span><span class="p">(</span><span class="n">squeeze</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">clevs</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdBu</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">drawparallels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">m</span><span class="o">.</span><span class="n">drawmeridians</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span><span class="mi">310</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s">&quot;horizontal&quot;</span><span class="p">)</span>
<span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&quot;correlation coefficient&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;EOF1 (correlation of PC1 with SST)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c"># Plot a line graph of the last 50 years of the PC time series.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">time</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">year</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">sst_djf_cp</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span><span class="o">.</span><span class="n">asComponentTime</span><span class="p">()]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:],</span> <span class="n">pc1</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;PC1 Time Series&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Year&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Normalized Units&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span> <span class="o">+</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
    <span class="n">l</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The plots output by this code are shown below. The spatial pattern of EOF1 is the canonical El Niño pattern, with warm anomalies in the equatorial East Pacific and a horseshoe of cold anomaly surrounding it. The PC1 time series shows variability on the typical El Niño time-scales of around 4-7 years, with notable peaks for the 1982/83 and 1997/98 El Niño events.</p>
<a class="reference internal image-reference" href="_images/example_sst_0.png"><img alt="Leading EOF of wintertime SST in the Central and North Pacific" src="_images/example_sst_0.png" style="width: 600.0px; height: 450.0px;" /></a>
<a class="reference internal image-reference" href="_images/example_sst_1.png"><img alt="Leading PC of wintertime SST in the Central and North Pacific" src="_images/example_sst_1.png" style="width: 600.0px; height: 450.0px;" /></a>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<h3>Table Of Contents</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Practical Example: Sea Surface Temperature (ENSO)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#getting-the-example-data">Getting The Example Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reading-and-preparing-the-example-data">Reading And Preparing The Example Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-eof-analysis">The EOF Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#visualizing-the-results">Visualizing The Results</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="refwrap.html">Metadata-Enabled Interface Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="refsolve.html">Non-metadata Interface Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Full API Reference</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="intro.html"
                        title="previous chapter">Introduction</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="refwrap.html"
                        title="next chapter">Metadata-Enabled Interface Reference</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/pexsst.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="refwrap.html" title="Metadata-Enabled Interface Reference"
             >next</a> |</li>
        <li class="right" >
          <a href="intro.html" title="Introduction"
             >previous</a> |</li>
        <li><a href="index.html">eof2 1.5.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Andrew Dawson.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>